<div class="chat-message-area">
  <div class="chat-message-header-bar">
    <h2 class="chat-current-title">{{activeThread.title}}</h2>
    <div class="chat-message-actions">
      <button class="chat-action-btn"
              hx-get="/chat/thread/{{activeThread.id}}/edit"
              hx-target="#modal-container"
              hx-swap="innerHTML">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        Edit
      </button>
      <button class="chat-action-btn chat-action-btn-danger"
              hx-delete="/chat/thread/{{activeThread.id}}"
              hx-target="#chat-container"
              hx-swap="innerHTML"
              hx-confirm="Delete channel '{{activeThread.title}}' and all its transmissions?">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          <line x1="10" y1="11" x2="10" y2="17"/>
          <line x1="14" y1="11" x2="14" y2="17"/>
        </svg>
        Delete
      </button>
    </div>
  </div>
  <div id="messages-list" class="chat-messages-list">
    {{#each messages}}
    <div id="message-{{id}}" class="chat-message">
      <div class="chat-message-header">
        <span class="chat-message-author">{{userName}}</span>
        <span class="chat-message-time">{{relativeTime}}</span>
      </div>
      <div class="chat-message-content">
        {{#each contentLines}}
        <p>{{this}}</p>
        {{/each}}
      </div>
      {{#if hasEmbeds}}
      <div class="chat-embeds">
        {{#each embeds}}
        <div class="chat-embed chat-embed-{{embedType}}">
          {{#if isYoutube}}
          <a href="{{url}}" target="_blank" class="chat-embed-youtube-link">
            <div class="chat-embed-youtube-thumb">
              <img src="{{thumbnailUrl}}" alt="{{title}}">
              <div class="chat-embed-play-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
              </div>
            </div>
            {{#if hasTitle}}
            <div class="chat-embed-youtube-info">
              <div class="chat-embed-title">{{title}}</div>
            </div>
            {{/if}}
          </a>
          {{else}}
          {{#if isTwitter}}
          <a href="{{url}}" target="_blank" class="chat-embed-twitter-link">
            <div class="chat-embed-twitter-header">
              <span class="chat-embed-twitter-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </span>
              {{#if hasAuthor}}<span class="chat-embed-twitter-author">{{authorName}}</span>{{/if}}
            </div>
            {{#if hasDescription}}<div class="chat-embed-twitter-text">{{description}}</div>{{/if}}
            {{#if hasThumbnail}}<img src="{{thumbnailUrl}}" alt="" class="chat-embed-twitter-image">{{/if}}
          </a>
          {{else}}
          <a href="{{url}}" target="_blank" class="chat-embed-generic-link">
            {{#if hasThumbnail}}<img src="{{thumbnailUrl}}" alt="" class="chat-embed-generic-thumb">{{/if}}
            <div class="chat-embed-generic-info">
              {{#if hasTitle}}<div class="chat-embed-title">{{title}}</div>{{/if}}
              {{#if hasDescription}}<div class="chat-embed-description">{{description}}</div>{{/if}}
            </div>
          </a>
          {{/if}}
          {{/if}}
        </div>
        {{/each}}
      </div>
      {{/if}}
      {{#if hasAttachments}}
      <div class="chat-attachments">
        {{#each attachments}}
        {{#if isImage}}
        <a href="{{url}}" target="_blank" class="chat-attachment-image">
          <img src="{{url}}" alt="{{fileName}}" class="chat-attachment-thumbnail">
        </a>
        {{else}}
        <a href="{{url}}" download="{{fileName}}" class="chat-attachment-file">
          <span class="chat-attachment-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </span>
          <span class="chat-attachment-name">{{fileName}}</span>
          <span class="chat-attachment-size">{{fileSizeFormatted}}</span>
        </a>
        {{/if}}
        {{/each}}
      </div>
      {{/if}}
    </div>
    {{/each}}
  </div>
  <form id="message-form"
        hx-post="/chat/thread/{{activeThread.id}}/message"
        hx-target="#messages-list"
        hx-swap="beforeend"
        hx-on::after-request="afterMessageSubmit(this)">
    <input type="hidden" name="_csrf" value="{{csrfToken}}">
    <input type="hidden" name="attachments" id="attachments-input" value="">
    <input type="file" id="file-input" class="chat-file-input"
           multiple="true" accept="image/*,.pdf,.txt"
           onchange="handleFileSelect(this.files)"
           data-thread-id="{{activeThread.id}}">
    <div id="upload-preview" class="chat-upload-preview"></div>
    <div class="chat-input-container" id="chat-input-drop-zone"
         ondragover="handleDragOver(event)"
         ondragleave="handleDragLeave(event)"
         ondrop="handleInputDrop(event)">
      <textarea name="content" id="message-content" class="chat-input"
                placeholder="Transmit message..." rows="2"
                onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); submitMessageWithAttachments(); }"></textarea>
      <button type="button" class="chat-attach-btn"
              onclick="document.getElementById('file-input').click()"
              title="Attach files">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
        </svg>
      </button>
      <button type="submit" class="chat-send-btn"
              onclick="event.preventDefault(); submitMessageWithAttachments()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
        Transmit
      </button>
    </div>
  </form>
</div>
