<div class="time-container">
  <!-- Timer section -->
  <div class="time-timer-section">
    {{#if hasActiveTimer}}
    <div class="time-timer-active">
      <div class="time-timer-display running">
        <span id="timer-value" data-start="{{timer.startTime}}">{{timerElapsed}}</span>
      </div>
      <div class="time-timer-info">
        <p class="time-timer-description">{{timer.description}}</p>
        <span class="time-category {{timer.categoryClass}}">{{timer.category}}</span>
      </div>
      <form hx-post="/time/stop" hx-swap="none" class="time-timer-form"
            hx-on::after-request="if(event.detail.successful) window.location.reload()">
        <button type="submit" class="btn btn-danger">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="6" y="6" width="12" height="12"/>
          </svg>
          Stop Timer
        </button>
      </form>
    </div>
    {{else}}
    <div class="time-timer-inactive">
      <div class="time-timer-display">
        <span id="timer-value">00:00:00</span>
      </div>
      <form hx-post="/time/start" hx-swap="none" class="time-timer-form"
            hx-on::after-request="if(event.detail.successful) window.location.reload()">
        <div class="form-row">
          <input type="text" name="description" placeholder="What are you working on?"
                 class="form-input" required>
          <select name="category" class="form-select">
            {{#each categories}}
            <option value="{{this}}">{{this}}</option>
            {{/each}}
          </select>
          <button type="submit" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
            Start
          </button>
        </div>
      </form>
    </div>
    {{/if}}
  </div>

  <!-- Today's summary -->
  <div class="time-today-summary">
    <div class="time-summary-header">
      <h2>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        Today
      </h2>
      <span class="time-summary-total">{{totalDuration}}</span>
    </div>
    {{#if hasCategorySummary}}
    <div class="time-summary-bar">
      {{#each categorySummary}}
      <div class="time-summary-segment {{categoryClass}}" style="flex-basis: {{percentage}}%"
           title="{{category}}: {{duration}}"></div>
      {{/each}}
    </div>
    {{/if}}
  </div>

  <!-- Today's entries -->
  <div class="time-entries-section">
    <div class="time-entries-header">
      <h3>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="8" y1="6" x2="21" y2="6"/>
          <line x1="8" y1="12" x2="21" y2="12"/>
          <line x1="8" y1="18" x2="21" y2="18"/>
          <line x1="3" y1="6" x2="3.01" y2="6"/>
          <line x1="3" y1="12" x2="3.01" y2="12"/>
          <line x1="3" y1="18" x2="3.01" y2="18"/>
        </svg>
        Time Entries
      </h3>
      <div class="time-entries-actions">
        <button hx-get="/time/entry/add" hx-target="#modal-container"
                hx-swap="innerHTML" class="btn btn-secondary btn-sm">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Manual Entry
        </button>
        <a href="/time/week" class="btn btn-secondary btn-sm">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Weekly Report
        </a>
      </div>
    </div>
    <div id="entries-container">
      {{#if hasEntries}}
      <table class="time-entries-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Description</th>
            <th>Category</th>
            <th>Duration</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each entries}}
          <tr id="entry-{{id}}" class="time-entry-row">
            <td class="time-entry-time">{{timeRange}}</td>
            <td class="time-entry-description">{{description}}</td>
            <td class="time-entry-category">
              <span class="time-category {{categoryClass}}">{{category}}</span>
            </td>
            <td class="time-entry-duration">{{durationFormatted}}</td>
            <td class="time-entry-actions">
              <button hx-get="/time/entry/{{id}}/edit" hx-target="#modal-container"
                      hx-swap="innerHTML" class="btn-icon" title="Edit">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
              </button>
              <button hx-delete="/time/entry/{{id}}" hx-swap="none"
                      hx-confirm="Delete this time entry?"
                      class="btn-icon btn-icon-danger" title="Delete">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  <line x1="10" y1="11" x2="10" y2="17"/>
                  <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
              </button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{else}}
      <div class="time-empty">
        <svg class="time-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <p>No time entries for today. Start tracking!</p>
      </div>
      {{/if}}
    </div>
  </div>

  <!-- Modal container -->
  <div id="modal-container"></div>

  <!-- Timer update script -->
  <script type="text/javascript">
    (function() {
      const timerEl = document.getElementById('timer-value');
      if (!timerEl || !timerEl.dataset.start) return;
      const startTime = parseInt(timerEl.dataset.start);
      function update() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const h = Math.floor(elapsed / 3600);
        const m = Math.floor((elapsed % 3600) / 60);
        const s = elapsed % 60;
        const pad = n => n.toString().padStart(2, '0');
        timerEl.textContent = pad(h) + ':' + pad(m) + ':' + pad(s);
      }
      update();
      setInterval(update, 1000);
    })();
  </script>

  <!-- SSE script -->
  <script src="/js/time.js"></script>
</div>
