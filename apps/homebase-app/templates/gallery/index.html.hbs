<div class="gallery-container">
  <!-- Header -->
  <div class="gallery-header">
    <h1>Gallery</h1>
    <span class="gallery-count">{{itemCount}} items</span>
  </div>

  <!-- Upload zone -->
  <div id="upload-zone" class="gallery-upload-zone">
    <form id="upload-form" hx-post="/gallery/upload" hx-encoding="multipart/form-data"
          hx-swap="none" hx-on::after-request="if(event.detail.successful) window.location.reload()">
      <input type="hidden" name="_csrf" value="{{csrfToken}}">
      <div class="gallery-upload-content">
        <span class="gallery-upload-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </span>
        <p class="gallery-upload-text">Drop files here or click to upload</p>
        <p class="gallery-upload-subtext">Images, PDFs, and text files</p>
        <input type="file" name="file" id="file-input" class="gallery-file-input"
               accept="image/*,.pdf,.txt" onchange="this.form.requestSubmit()">
      </div>
    </form>
  </div>

  <!-- Filters -->
  <div class="gallery-filters">
    <a href="/gallery" class="gallery-filter-tab{{#if filterAll}} active{{/if}}">All</a>
    <a href="/gallery?filter=images" class="gallery-filter-tab{{#if filterImages}} active{{/if}}">Images</a>
    <a href="/gallery?filter=documents" class="gallery-filter-tab{{#if filterDocuments}} active{{/if}}">Documents</a>
  </div>

  <!-- Grid -->
  <div id="gallery-items">
    {{#if hasItems}}
    <div class="gallery-grid">
      {{#each items}}
      <div id="item-{{id}}" class="gallery-item"
           hx-get="/gallery/item/{{id}}" hx-target="#modal-container" hx-swap="innerHTML">
        {{#if isImage}}
        <div class="gallery-thumbnail">
          <img src="{{url}}" alt="{{title}}" loading="lazy">
        </div>
        {{else}}
        <div class="gallery-thumbnail gallery-file">
          <span class="gallery-file-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10 9 9 9 8 9"/>
            </svg>
          </span>
          <span class="gallery-file-ext">{{extension}}</span>
        </div>
        {{/if}}
        <div class="gallery-item-info">
          <p class="gallery-item-title">{{displayTitle}}</p>
          <p class="gallery-item-meta">{{formattedSize}} Â· {{relativeTime}}</p>
        </div>
      </div>
      {{/each}}
    </div>
    {{else}}
    <div class="gallery-empty">
      <div class="gallery-empty-icon">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
      </div>
      <p>No items in your gallery yet.</p>
      <p class="text-muted">Upload some photos or files to get started!</p>
    </div>
    {{/if}}
  </div>

  <!-- Modal container -->
  <div id="modal-container"></div>

  <!-- Drag & drop script -->
  <script type="text/javascript">
  (function() {
    const zone = document.getElementById('upload-zone');
    const input = document.getElementById('file-input');
    if (!zone || !input) return;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
      zone.addEventListener(event, e => { e.preventDefault(); e.stopPropagation(); });
    });
    ['dragenter', 'dragover'].forEach(event => {
      zone.addEventListener(event, () => zone.classList.add('dragover'));
    });
    ['dragleave', 'drop'].forEach(event => {
      zone.addEventListener(event, () => zone.classList.remove('dragover'));
    });
    zone.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        input.files = files;
        document.getElementById('upload-form').requestSubmit();
      }
    });
    zone.addEventListener('click', () => input.click());
  })();
  </script>

  <!-- SSE for real-time updates -->
  <script src="/js/gallery.js"></script>
</div>
